mruby-apr
=========

The [Apache Portable Runtime Project](https://apr.apache.org/) is a collection of "software libraries that provide a predictable and consistent interface to underlying platform-specific implementations." `mruby-apr` leverages the work done by the APR developers to provide a cross-platform API for system facilities (like processes) to mruby without having to repeat this work.

`mrb-apr` was created as a component of the [lamina project](https://github.com/jbreeden/lamina). Feature development

API
---

Look in the `docs/` folder for a full API reference. The rest of this section describes design decisions.

- `mruby-apr` defines the APR module along with a set of child modules & classes. All of the functionality of `mruby-apr` can be accessed through this module. 
- In the `APR` module, behavior is permitted to differ from the CRuby standard significantly (opting instead for a more direct APR wrapper). 
- When appropriate, the routines in APR are wrapped in a standard Ruby API (for example, by defining methods on the `Kernel` or `Process` modules). 
- This seems to give the best mix of straightforward wrapping, full APR access, and familiar Ruby APIs.

Docs are being generated by a quick-and-dirty markdown extractor dubbed `md-doc.rb` (it's in the repo). I'm sure I could be using rdoc, so I'll look into that when the project outgrows `md-doc`

Building
--------

To build this gem into your mruby instance, just download the repo and add a couple of lines to your `build_config.rb` file:

```Ruby
MRuby::Build.new('host') do |conf|
  # ... Other configurations...

  # mruby-apr depends on these other mrbgems
  conf.gem :github => 'iij/mruby-io'
  conf.gem :github => 'iij/mruby-errno'

  # Include the mruby-apr gem
  conf.gem "PATH/TO/mruby-apr"

  # Call configure_muby_apr with the `conf` object
  # (This just sets the required compiler options)
  configure_mruby_apr(conf)

end
```

There is a pre-built apr lib bundled with this gem that will be used on Windows. On unix systems, you'll need to download the APR sources (version 1.5.1) and build with:

```sh
configure
make
sudo make install
```

By default, this will install APR to `/usr/local/apr`, and that's where this gem will look for the required files. If you've installed APR elsewhere, you can just update the path in the mrbgem.rake file.

Dependencies
------------

`mruby-apr` currently depends on the `mruby-io` and `mruby-errno` gems, which should both be listed _before_ `mruby-apr` in your `build_config.rb` file. This is important since `mruby-apr` will expect some classes from `mruby-io` to be defined, and some functions will be overwriten.


